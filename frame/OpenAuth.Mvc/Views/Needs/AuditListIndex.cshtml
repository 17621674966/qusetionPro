

@{
    ViewBag.Title = "供需求审核";
}
<!--上面的查询按钮-->
<blockquote class="layui-elem-quote layui-text">

    <form class="layui-form" action="">
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">标题:</label>
                <div class="layui-input-inline">
                    <input type="text" name="txt_Title" id="txt_Title" autocomplete="off" placeholder="请输入供需求标题查询" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">发布人</label>
                <div class="layui-input-inline">
                    <input type="text" name="txt_AddUserName" id="txt_AddUserName" autocomplete="off" placeholder="请输入发布人、发布公司" class="layui-input">
                </div>
            </div>

            <div class="layui-inline">
                <label class="layui-form-label">审核状态</label>
                <div class="layui-input-inline">
                    <select id="ddl_AuditStatus" name="ddl_AuditStatus">
                        <option value="">所有状态</option>
                        <option value="0">待审核</option>
                        <option value="1">审核通过</option>
                        <option value="2">审核不通过</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">发布时间:</label>
                <div class="layui-input-inline">
                    <input type="text" name="txt_AddTimeBegin" id="txt_AddTimeBegin" autocomplete="off" placeholder="供需求发布开始时间" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">至</label>
                <div class="layui-input-inline">
                    <input type="text" name="txt_AddTimeEnd" id="txt_AddTimeEnd" autocomplete="off" placeholder="供需求发布结束时间" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">发布类型</label>
                <div class="layui-input-inline" style="width:300px">
                    <input type="radio" name="radio_type" value="-1" title="全部" checked="checked">
                    <input type="radio" name="radio_type" value="1" title="需求" >
                    <input type="radio" name="radio_type" value="2" title="供给">
                </div>
            </div>
            <div class="layui-inline">
                <div class="layui-input-inline">
                    <button type="button" class="layui-btn" id="btn_ok">查询</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </div>
    </form>
</blockquote>

<table class="layui-hide" id="grid" lay-filter="grid"></table>
<script type="text/html" id="toolBarDemo">
    <div class="layui-btn-container">

        <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="del">删除</button>
    </div>
</script>
<script type="text/html" id="auditStatus">
    
    {{#  if(d.AuditStatus ==0){ }}

    <button class="layui-btn layui-btn-primary layui-btn-xs">
        <i class="layui-icon">&#x1006;</i>未审核
    </button>
    {{#  } }}
    {{#  if(d.AuditStatus ==1){ }}

    <button class="layui-btn layui-btn-xs">
        <i class="layui-icon">&#xe605;</i>审核通过
    </button>
    {{#  } }}
    {{#  if(d.AuditStatus ==2){ }}

    <button class="layui-btn layui-btn-xs layui-btn-danger"> 审核不通过
    </button>
    {{#  } }}


</script>


<script type="text/html" id="type">

    {{#  if(d.Type ==1){ }}

    <a>需求</a>
    {{#  } }}
    {{#  if(d.Type ==2){ }}
    <a>供给</a>

    {{#  } }}



</script>


<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="detail">查看</a>   
</script>


<script type="text/javascript" src="/layui/layui.js"></script>
<script type="text/javascript">
    layui.config({
        base: "/js/"
    }).use(['form', 'layer', 'jquery', 'table', 'laydate'], function () {
        var form = layui.form,
            layer = layui.layer,
            $ = layui.jquery;
        var table = layui.table;
        var laydate = layui.laydate;

        laydate.render({
            elem: '#txt_AddTimeBegin'
        });
        laydate.render({
            elem: '#txt_AddTimeEnd'
        });

        table.render({
            elem: '#grid'
            , url: '/Needs/GetList/'
            , page: true
            , toolbar: "#toolBarDemo"
            , method: 'POST'
            , limit: 10
            , limits: [10, 20, 30]
            , event: true
            , loading: true
            , id: 'grid'
            , cols: [[
                { checkbox: true, title: '序号' }
                , { field: 'Type', width: 120, title: '发布类型', toolbar: '#type'}
                , { field: 'TypeItemName', width: 120, title: '类型' }
                , { align: 'center', width:80, title:'操作', toolbar: '#barDemo'}
                , { field: 'Title', width: 500, title: '标题' }
                , { field: 'AuditStatus', width: 110, title: '状态', toolbar: "#auditStatus" }
                , { field: 'AddUserName', width: 150, title: '发布人' }
                , { field: 'CompanyName', width: 180, title: '所属公司' }
                , { field: 'AddTimeStr', width: 180, title: '发布时间' }

            ]]
            , where: {
                title: $("#txt_Title").val(),
                addUserName: $("#txt_AddUserName").val(),
                beginTime: $("#txt_AddTimeBegin").val(),
                endTime: $("#txt_AddTimeEnd").val(),
                status: $("#ddl_AuditStatus").val(),
                type: $("input[name='radio_type']:checked").val()
            }

        });


        //toolBar事件
        table.on('toolbar(grid)', function (obj) {
            var checkStatus = table.checkStatus(obj.config.id);
            switch (obj.event) {
                case "del":
                    var data = checkStatus.data;

                    layer.confirm("你确定要删除选中的数据么?", function () {
                        if (data.length <= 0 || data.length > 1) {
                            layer.msg("请选择一行数据删除!");
                            return;
                        }
                        GetDataByJson('/Needs/DeleteInformation/', 'Post', { rowGuid: data[0].RowGuid }, function (res) {

                            if (res.Code == 200) {
                                layer.msg("删除成功!");
                                table.reload('grid', {
                                    page: {
                                        curr: 1 //重新从第 1 页开始
                                    }
                                    , where: {

                                        title: $("#txt_Title").val(),
                                        addUserName: $("#txt_AddUserName").val(),
                                        beginTime: $("#txt_AddTimeBegin").val(),
                                        endTime: $("#txt_AddTimeEnd").val(),
                                        status: $("#ddl_AuditStatus").val(),
                                        type : $("input[name='radio_type']:checked").val()
                                    }
                                })
                            }
                            else {
                                layer.msg(res.Message);
                            }

                        })

                    })
                    break;
            }

        })

        table.on('tool(grid)', function (obj) {
            var data = obj.data;
            if (obj.event === 'detail') {

                  var index =layer.open({
                        type: 2
                        , title: '资讯审核'
                      , content: '@Url.Action("Detail", "Needs")' +"?rowGuid="+data.RowGuid
                        , area: ['1000px', '800px']
                        , shade: 0.4 //不显示遮罩
                        , end: function () {

                            table.reload('grid', {
                                page: {
                                    curr: 1 //重新从第 1 页开始
                                }
                                , where: {
                                    title: $("#txt_Title").val(),
                                    addUserName: $("#txt_AddUserName").val(),
                                    beginTime: $("#txt_AddTimeBegin").val(),
                                    endTime: $("#txt_AddTimeEnd").val(),
                                    status: $("#ddl_AuditStatus").val(),
                                    type : $("input[name='radio_type']:checked").val()

                                }
                            })

                        }

                  });
                layer.full(index);
               

            }
        })
        //点击查询
        $("#btn_ok").click(function () {

            table.reload('grid', {
                page: {
                    curr: 1 //重新从第 1 页开始
                }
                , where: {
                    title: $("#txt_Title").val(),
                    addUserName: $("#txt_AddUserName").val(),
                    beginTime: $("#txt_AddTimeBegin").val(),
                    endTime: $("#txt_AddTimeEnd").val(),
                    status: $("#ddl_AuditStatus").val(),
                    type : $("input[name='radio_type']:checked").val()

                }
            })
        });


    })


</script>










