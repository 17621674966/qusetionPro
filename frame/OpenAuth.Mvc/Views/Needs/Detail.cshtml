
@{
    ViewBag.Title = "供需求明细";
}

@using OpenAuth.Repository.Domain.DonvvOffice;
@model  T_Needs_Info

    <form class="layui-form layui-form-pane" action="" style="padding-top:20px" lay-filter="example">

        <div class="layui-form-item">
            <label class="layui-form-label">发布类型</label>
            <div class="layui-input-block">
                <input type="radio" name="radio_type" value="1" title="需求" checked="">
                <input type="radio" name="radio_type" value="2" title="供给">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">类型</label>
            <div class="layui-input-block">
                <select id="ddl_Type" name="ddl_Type">

                    @foreach (var item in ViewBag.TypeItem)
                    {
                        <option value="@item.RowGuid">@item.ItemName</option>
                    }
                </select>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">标题</label>
            <div class="layui-input-block">
                <input type="text" name="txt_Title" autocomplete="off" id="txt_Title" placeholder="请输入资讯标题" class="layui-input" value="@Model.Title">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">摘要</label>
            <div class="layui-input-block">
                <textarea placeholder="请输入摘要" class="layui-textarea" name="txt_OutLine" id="txt_OutLine"></textarea>
            </div>
        </div>

        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">内容</label>
            <div class="layui-input-block">


                <div id="txt_ContentValue" style="margin:20px"></div>

            </div>
        </div>



        <div class="layui-form-item">
            <label class="layui-form-label">附件照片</label>
            <div class="layui-input-block">
                <div class="layui-upload-list" id="demo2">
                    @foreach (var item in ViewBag.AttachList)
                    {
                        <img class="layui-upload-img" src="@item.AttachUrl" style="width:800px">
                    }

                </div>
            </div>
        </div>



        <div class="layui-form-item">
            <div class="layui-input-block">
                <button type="button" class="layui-btn" id="btn_AuditPass">审核通过</button>
                <button type="button" class="layui-btn layui-btn-primary" id="btn_NotAuditPass">审核不通过</button>
            </div>
        </div>

        <div class="layui-form-item" id="txt_AuditUnReasonContent" hidden="hidden">
            <div class="layui-input-block" style="margin-left:0px">
                <textarea placeholder="请输入审核不通过理由" id="txt_AuditUnReason" name="txt_AuditUnReason" class="layui-textarea"></textarea>
            </div>
        </div>




        <script type="text/javascript" src="/layui/layui.js"></script>
        <script src="~/js/GetParam.js"></script>
        <script type="text/javascript">


        layui.config({
            base: "/js/"
        }).use(['form', 'layer'], function () {
            var form = layui.form,
                layer = layui.layer
            $ = layui.jquery;
            var rowGuid = getQueryString("rowGuid");
            form.val('example', {
                 "ddl_Type": "@Model.TypeItemGuid"
                , "txt_Title": "@Model.Title"
                , "txt_OutLine": "@Model.OutLine"
                ,"radio_type":"@Model.Type"



            });


            $("#txt_ContentValue").html('@Html.Raw(Model.ContentValue)')


            $("#btn_AuditPass").click(function () {
                layer.confirm('你确定要审核通过该条信息么？', function () {

                    GetDataByJson('/Needs/Audit/', 'Post', {
                        type: 1,
                        contentValue: '',
                        rowGuid: rowGuid
                    }, function (res) {
                        if (res.Code == 200) {
                            layer.msg("审核成功!");

                        }
                        else {
                            layer.msg(res.Message);
                        }

                    })

                })
            })



            $("#btn_NotAuditPass").click(function () {
                layer.confirm('你确定要审核不通过该条信息么？', function () {
                    layer.open({
                        type: 1
                        , title: '审核不通过理由'
                        , area: ['390px', '260px']
                        , content: $('#txt_AuditUnReasonContent')
                        , btn: ['确定', '关闭'] //只是为了演示
                        , yes: function () {

                            if ($("#txt_AuditUnReason").val() == "") {
                                layer.msg("请输入审核不通过理由!");
                                return;
                            }

                            GetDataByJson('/Needs/Audit/', 'Post', {
                                type: 2,
                                contentValue: $("#txt_AuditUnReason").val(),
                                rowGuid: rowGuid
                            }, function (res) {
                                if (res.Code == 200) {
                                    layer.msg("审核成功!");

                                }
                                else {
                                    layer.msg(res.Message);
                                }

                            })
                        }
                        , btn2: function () {
                            layer.closeAll();
                        }
                    });


                })
            })
        })
        </script>


    </form>



